"use strict";var Util=Backbone.Model.extend({initialize:function(e){return e||(e={}),this},bounds_ob_from_bbox_string:function(e){var n=e.split(",");if(n.length<4)return"incomplete bbox submitted";var i=L.latLng(n[1],n[0]),r=L.latLng(n[3],n[2]);return L.latLngBounds(i,r)},geom_id_nudge:function(e,n,i){if(void 0===i||null==i)i="down";var r=null;switch(e){case"line":r="down"==i?Number(n)/CONFIG.pliers.line:Number(n)*CONFIG.pliers.line;break;case"poly":r="down"==i?Number(n)/CONFIG.pliers.poly:Number(n)*CONFIG.pliers.poly;break;default:r=Number(n)}return r}});
"use strict";var Query=Backbone.Model.extend({defaults:{recordOffset:0,page:1},query_facetadd:function(){var e=appQueryFacets.facetArray(),t=_.map(e,function(e){var t=e.split(":"),i=t[0],r=t[1],a=null;switch(i){case"tags":a="tags.comma_del";break;default:a=i}return a+':"'+r+'"'});return t.length>0?" AND ("+t.join(" AND ")+")":""},query_primitive:function(e){var t=void 0===e||null==e?"":this.query_facetadd();return{query_string:{default_operator:"AND",query:(this.get("raw")+t+" AND holding:false").replace("?","\\?").replace("!","\\!").replace("!","\\!")}}},queryobj:function(){var e={filter:this.query_primitive(),aggregations:{filtered_bits:{terms:{size:1e4,field:"bit.keyword"}}}},t={filter:this.query_primitive(),aggregations:{filtered_guests:{terms:{size:1e4,field:"episode_guests.comma_del"}}}},i={filter:this.query_primitive(),aggregations:{filtered_tags:{terms:{size:1e4,field:"tags.comma_del"}}}},r={filter:this.query_primitive(),aggregations:{filtered_episodes:{terms:{size:1e4,field:"episode.keyword"}}}},a={all_bits:{global:{},aggregations:{}}};return appQuery.get("raw").indexOf("episode:")>=0&&(t=null),null!==t&&(a.all_bits.aggregations.guests=t),null!==i&&(a.all_bits.aggregations.tags=i),null!==e&&(a.all_bits.aggregations.bits=e),null!==r&&(a.all_bits.aggregations.episodes=r),{size:1e4,query:this.query_primitive("full"),aggregations:a}},querystringSOLR:function(){var e="",t=appState.facetArray();t.length>0&&(e=" AND ("+t.join(" AND ")+")");return this.get("query_root")+"&q="+this.get("raw")+e}});
"use strict";var QueryView=Backbone.View.extend({el:$("#query-form"),template:CBB.templates.queryViewTpl,events:{"click #cbb-bt-search":"set","click #cbb-bt-random":"rando"},bindings:{input:"raw"},initialize:function(){return this.render()},rando:function(){var t=String.fromCharCode(Math.floor(26*Math.random())+97)+"*",e=String.fromCharCode(Math.floor(26*Math.random())+97)+"*";return appQuery.set({raw:t+e}),this},set:function(t){var e=$("#query-form input").val();return this.model.set({raw:e}),this},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this.stickit()}});
"use strict";var Bit=Backbone.Model.extend({defaults:{}});
"use strict";var Slug=Backbone.Model.extend({defaults:{}});
"use strict";var Update=Backbone.Model.extend({url:null,defaults:{},initialize:function(n){return n||(n={}),this},sync:function(n,t,e){return e.dataType="json",e.async=!0,e.url=this.url,e.method="GET",Backbone.sync(n,t,e)},parse:function(n){return n}});
"use strict";var Updates=Backbone.Collection.extend({model:Update,url:"offline/update.json",initialize:function(n){return n||(n={}),this},sync:function(n,e,t){return t.dataType="json",t.async=!0,t.url=this.url,t.method="GET",Backbone.sync(n,e,t)},parse:function(n){return n}});
"use strict";var Locations=Backbone.Collection.extend({model:Bit,initialize:function(t){t||(t={})},url:function(){var t=null;switch(CONFIG.mode){case"T":t="http://localhost:3030/geoms/offline?q="+appState.get("locations");break;case"33":t="http://milleria.org:3030/geoms/cbb?q="+appState.get("locations");break;default:t="http://milleria.org:3030/geoms/cbb?q="+appState.get("locations")}return t},sync:function(t,a,e){return e.dataType="jsonp",e.jsonpCallback="cwmccallback",Backbone.sync(t,a,e)}});
"use strict";var LocationsView=Backbone.View.extend({el:null,events:{},initialize:function(){return this.collection.bind("sync",this.render,this),this},render:function(){return BitGroup.clearLayers(),this.collection.each(function(e,t){var i=(0,CBB.templates.bitMarkerViewTpl)(e.get("properties")),o=e.get("geometry").type,n=this.get_style(),r=this.get_style("active"),l=this.get_style("seen"),c=e.attributes;if("point"==o.toLowerCase()){(s=L.geoJson(c,{seen:!1,location_id:e.get("properties").cartodb_id,location_type:e.get("geometry").type.toLowerCase(),pointToLayer:function(e,t){return L.circleMarker(t,n)}})).bindPopup(i).addTo(BitGroup).on("click",function(e){e.target.setStyle(r)}).addOneTimeEventListener("popupopen",function(e){})}else{var s;(s=L.geoJson(c,{seen:!1,location_id:e.get("properties").cartodb_id,location_type:e.get("geometry").type.toLowerCase(),style:n})).bindPopup(i).addTo(BitGroup).on("click",function(e){e.target.setStyle(r);_.find(BitGroup._layers,function(e){return 1==e.options.seen})}).addOneTimeEventListener("popupopen",function(e){})}s.on("popupclose",function(e){e.target.setStyle(l)}),void 0===c.options&&(c.options={cartodb_id:null}),c.options.cartodb_id=e.get("properties").cartodb_id.toString()},this),this.collection.length>0&&map.fitBounds(BitGroup.getBounds()),appActivityView.stfu(),this},get_style:function(e){switch(e){case"active":return{radius:18,fillColor:"#fecd0b",color:"#000",weight:1,opacity:1,fillOpacity:1};case"seen":return{radius:6,fillColor:"#ffffff",color:"#1288b9",weight:1,opacity:.6,fillOpacity:1};case"linenew":return{fillColor:"rgba(126, 223, 216, 100)",color:"rgba(126, 223, 216, 100)",weight:6,opacity:1};case"lineactive":return{fillColor:"#fecd0b",color:"#fecd0b",weight:8,opacity:1};case"lineseen":return{fillColor:"#ffffff",color:"#ffffff",weight:6,opacity:1};default:return{radius:6,fillColor:"rgb(255, 128, 0)",fillOpacity:.8,color:"#000",weight:1,opacity:1}}}});
"use strict";var Slugs=Backbone.Collection.extend({model:Slug,url:null,initialize:function(t){t||(t={})},switch:function(t){this.invoke("set",{active:!1},{silent:!0});var e=this.map(function(e){return e.get("slug")==t?e.set({active:"is-active"}):e.set({active:!1}),e});return this.reset(e)},active:function(){return this.findWhere({active:"is-active"})}});
"use strict";var Facets=Backbone.Collection.extend({model:Bit,url:null,initialize:function(e){e||(e={})}});
"use strict";var QueryFacets=Backbone.Collection.extend({model:Bit,url:null,initialize:function(e){e||(e={})},facet:function(e){return void 0===appQueryFacets.findWhere(e)?this.add(e):this.remove(appQueryFacets.findWhere(e)),this},facetArray:function(){var e=[];return _.each(this.models,function(t){for(var r in t.attributes)if(t.attributes.hasOwnProperty(r))var i=r;e.push(i+":"+t.get(i))}),e}});
"use strict";var Bits=Backbone.Collection.extend({model:Bit,url:function(){appQuery.get("raw");var e=null;switch(CONFIG.mode){case"T":default:e=CONFIG.index_root}return e},initialize:function(e){return e||(e={}),this.listenTo(appQuery,"change:raw",this.upf),this.listenTo(appQueryFacets,"add remove reset",this.upf),this},upf:function(){return this.fetch()},sync:function(e,t,s){return s.dataType="json",s.async=!0,s.url=this.url(),s.method="POST",s.data=JSON.stringify(appQuery.queryobj()),Backbone.sync(e,t,s)},parse:function(e){appActivity.set({message:"extracting locations..."});var t=_.map(_.filter(e.hits.hits,function(e){return"Location"==e._source.bit&&""!==e._source.location_id&&""!==e._source.location_type}),function(e){return e._source.location_type+":"+e._source.location_id});appState.set({locations:t.join(",")}),appActivity.set({message:"setting facets..."});var s=_.map(e.aggregations.all_bits.bits.filtered_bits.buckets,function(e,t){var s={bit:e.key},a=appQueryFacets.findWhere(s)?"is-active":"";return{type:"bits",facet:e.key,count:e.doc_count,active:a}});if(appFacetsBits.reset(s),void 0!==e.aggregations.all_bits.tags){var a=_.map(e.aggregations.all_bits.tags.filtered_tags.buckets,function(e,t){var s={tags:e.key},a=appQueryFacets.findWhere(s)?"is-active":"";return{type:"tags",facet:e.key,count:e.doc_count,active:a}});appFacetsTags.reset(a)}if(void 0!==e.aggregations.all_bits.guests){var i=_.map(e.aggregations.all_bits.guests.filtered_guests.buckets,function(e,t){var s={episode_guests:e.key},a=appQueryFacets.findWhere(s)?"is-active":"";return{type:"guests",facet:e.key,count:e.doc_count,active:a}});appFacetsGuests.reset(i)}if(void 0!==e.aggregations.all_bits.episodes){var o=_.map(e.aggregations.all_bits.episodes.filtered_episodes.buckets,function(e,t){var s={episode:e.key},a=appQueryFacets.findWhere(s)?"is-active":"";return{type:"episode",facet:e.key,count:e.doc_count,active:a}});appFacetsEpisodes.reset(o)}appState.set({search_results_count:e.hits.hits.length}),appActivity.set({message:"done!",hang:10});return _.map(e.hits.hits,function(e){var t=e._source,s=e._source.created_at==e._source.updated_at?null:moment(e._source.updated_at).format("YYYY.MMM.DD"),a=null==e._source.episode_title||""==e._source.episode_title?e._source.episode.split("/")[e._source.episode.split("/").length-1]:e._source.episode_title,i=""!==e._source.tags&&null!==e._source.tags&&void 0!==e._source.tags?e._source.tags.split(","):null;return t.meta={created:moment(e._source.created_at).format("YYYY.MMM.DD"),updated:s,episode_string:a,tags:i,elucidation:e._source.elucidation,_id:"_id:"+e._id},t})}});
"use strict";var Browse=Backbone.Collection.extend({model:Bit,url:function(){var e=null;switch(CONFIG.mode){case"T":default:e=CONFIG.index_root}return e},initialize:function(e){return e||(e={}),this},upf:function(){return this.fetch()},queryobj:function(){return{size:0,query:{query_string:{default_operator:"AND",query:"*:*"}},aggregations:{all_bits:{global:{},aggregations:{guests:{filter:{query_string:{default_operator:"AND",query:"*:*"}},aggregations:{filtered_guests:{terms:{size:1e6,field:"episode_guests.comma_del"}}}},tags:{filter:{query_string:{default_operator:"AND",query:"*:*"}},aggregations:{filtered_tags:{terms:{size:1e6,field:"tags.comma_del"}}}},bits:{filter:{query_string:{default_operator:"AND",query:"*:*"}},aggregations:{filtered_bits:{terms:{size:1e6,field:"bit.keyword"}}}},episodes:{filter:{query_string:{default_operator:"AND",query:"*:*"}},aggregations:{filtered_episodes:{terms:{size:1e6,field:"episode.keyword"}}}}}}}}},sync:function(e,t,s){return s.dataType="json",s.async=!0,s.url=this.url(),s.method="POST",s.data=JSON.stringify(this.queryobj()),Backbone.sync(e,t,s)},parse:function(e){appActivity.set({message:"parsing uniques (for browse)..."});var t=_.map(e.aggregations.all_bits.bits.filtered_bits.buckets,function(e,t){return{type:"bit",unique:e.key,unique_display:e.key,count:e.doc_count}}),s=_.map(e.aggregations.all_bits.tags.filtered_tags.buckets,function(e,t){return{type:"tags",unique:e.key,unique_display:e.key,count:e.doc_count}}),r=_.map(e.aggregations.all_bits.guests.filtered_guests.buckets,function(e,t){return{type:"guests",unique:e.key,unique_display:e.key,count:e.doc_count}}),i=_.reject(s,function(e){return""==e.unique}),u=_.map(e.aggregations.all_bits.episodes.filtered_episodes.buckets,function(e,t){var s=e.key.split("/"),r=s.length>1?s[s.length-1]:s;return{type:"episode",unique:e.key,unique_display:r,count:e.doc_count}});appBrowseBits.reset(t),appBrowseTags.reset(i),appBrowseEpisodes.reset(u),appBrowseGuests.reset(r);return[]}});
"use strict";var BaseLayer=Backbone.Model.extend({defaults:{active:!1}});
"use strict";var BaseLayersCollection=Backbone.Collection.extend({model:BaseLayer,url:null,initialize:function(e){e||(e={}),this.listenTo(appState,"change:baselayer",this.switch)},switch:function(e){return this.invoke("set",{active:!1},{silent:!0}),this.activate(e)},activate:function(e){var t=e&&void 0!==e?e:appState.get("baselayer");if(void 0!==e){this.findWhere({name:t}).set({active:!0})}return this}});
"use strict";var BaseLayersView=Backbone.View.extend({id:"map",initialize:function(){return this.listenTo(this.collection,"change:active",this.render),this.render()},render:function(){var e=this.collection.findWhere({active:!0}),i=void 0!==e?e.get("definition"):null;if(void 0===n)var n=null;else map.removeLayer(n);return n=void 0!==e&&"stamen"==e.get("source")?new L.StamenTileLayer(i.id):void 0!==i.subdomains?new L.TileLayer(i.url,{subdomains:i.subdomains,maxZoom:18}):new L.TileLayer(i.url,{maxZoom:18}),map.addLayer(n),n.bringToBack(),this}});
"use strict";var BaseLayersMenuItemView=Backbone.View.extend({tagName:"li",className:"pull-left",template:CBB.templates.baseLayerMnuItem,events:{"click .mnuThumbnail":"setActive"},initialize:function(){},debug:function(){return this},killtt:function(){$(this.el).find(".mnuThumbnail").tooltip("destroy")},setActive:function(e){return e.preventDefault(),1==this.model.get("active")?this:(_.invoke(appBaseLayers.models,function(){this.set({active:!1},{silent:!0})}),this.model.set({active:!0}),this)},setBaseMap:function(){this.model.set({active:!0});var e=this.model;appBaseMap.set(e)},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this.rewire()},rewire:function(){return $(this.el).find(".mnuThumbnail").tooltip("destroy"),$(this.el).find(".mnuThumbnail").tooltip({container:"body",placement:"right",trigger:"hover"}),this}});
"use strict";var BaseLayersMenuView=Backbone.View.extend({tagName:"ul",el:"#basemap-menu",template:CBB.templates.baseLayerMnu,events:{},initialize:function(){this.collection.bind("change:active",this.render,this),this.render()},render:function(){return $(this.el).html(this.template({baselayers:this.collection.toJSON()})),this},renderOG:function(){return $(this.el).empty(),this.collection.each(function(e){var t=new BaseLayersMenuItemView({model:e});$(this.el).append(t.render().el)},this),this.rewire()},rewire:function(){return $(".mnuThumbnail").tooltip(),$("#BaseMapConsole").html($(".mnuThumbnail.true").attr("title")),this.$(".mnuThumbnail").hover(function(){$("#BaseMapConsole").addClass("temp"),$("#BaseMapConsole").html(this.title)},function(){$("#BaseMapConsole").removeClass("temp"),$("#BaseMapConsole").html($(".mnuThumbnail.true").attr("title"))},this),this},process:function(e){if(1==e.get("active")){var t=this.collection.find(function(t){return e!==t&&t.get("active")});null!=t&&t.set({active:!1})}}});
"use strict";var Activity=Backbone.Model.extend({defaults:{message:null,show:!1}});
"use strict";var ActivityView=Backbone.View.extend({el:$("#activityContainer"),template:CBB.templates.activityViewTpl,events:{"click .activity-cancel":"stfu"},initialize:function(){this.model.bind("change",this.render,this)},stfu:function(){return $(this.el).fadeOut("slow"),this},warn:function(){return $(this.el).find(".activity-cancel").show(),setTimeout(_.bind(this.stfu,this),4e3),this},render:function(){$(this.el).show(),$(this.el).html(this.template(this.model.toJSON()));var t=void 0===this.model.get("hang")?4e3:1e3*parseInt(this.model.get("hang"));return setTimeout(_.bind(this.stfu,this),t),this}});
"use strict";var State=Backbone.Model.extend({defaults:{locations:null},initialize:function(t){return t||(t={}),this.listenTo(this,"change:locations",this.proxy_locations),this},proxy_locations:function(){return void 0!==this.get("locations")&&null!==this.get("locations")&&appLocations.fetch(),this},slugify:function(t){var i=this.get("slugs"),s=_.map(i,function(i){return i.slug==t?{name:i.name,slug:i.slug,active:"is-active"}:{name:i.name,slug:i.slug,active:null}});return this.set({slugs:s}),this}});
"use strict";var StateViewDownMenu=Backbone.View.extend({el:$("#cbb-bt-map-toggle"),template:CBB.templates.statesViewTpl_default,events:{"click i":"setm"},initialize:function(){return this.model.bind("change:downout",this.render,this),this.render()},setm:function(){var t="out"==this.model.get("downout")?"down":"out";return this.model.set({downout:t}),this},render:function(){return"down"==this.model.get("downout")?$("#cbb-main").addClass("down"):$("#cbb-main").removeClass("down"),$(this.el).html(this.template(this.model.toJSON())),this},rewire:function(){return 1==CONFIG.verbose&&console.info("------\x3e StatesVIew --\x3e rewire"),$(this.el).find('[data-toggle="tooltip"]').tooltip("destroy"),$(this.el).find('[data-toggle="tooltip"]').tooltip({position:"right",container:"body"}),this},reset:function(){return 1==CONFIG.verbose&&console.info("------\x3e StatesVIew --\x3e reset"),this.render()}});
"use strict";var SlugsViewPanes=Backbone.View.extend({el:$("#cbb-main-panes"),events:{"click .cbb-trigger":"trigger"},initialize:function(){return this.collection.bind("change",this.render,this),this.render()},trigger:function(t){if(t.preventDefault(),""==$(t.currentTarget).attr("data-type"))var e=$(t.currentTarget).attr("data-target");else e=$(t.currentTarget).attr("data-type")+':"'+$(t.currentTarget).attr("data-target")+'"';return appQuery.set({raw:e}),appSlugs.switch("search"),this},setp:function(t){return t.preventDefault(),appState.slugify($(t.currentTarget).attr("data-id")),this},render:function(){var t=this.collection.active().get("slug"),e=null;e=CBB.templates["0-"+t],$(".cbb-main-pane").each(function(){0==$(this).hasClass("hidden")&&$(this).addClass("hidden")});var a=$(".cbb-main-pane[id='pane-"+t+"']");return"search"!==t&&"browse"!==t&&"update"!==t&&$(a).html(e(this.collection.toJSON())),$(a).hasClass("hidden")&&$(a).removeClass("hidden"),this}});
"use strict";var SlugsViewPanesMenu=Backbone.View.extend({el:$("#cbb-pane-menu"),template:CBB.templates.slugsViewTpl_menu,events:{"click li":"setp"},initialize:function(){return this.collection.bind("change reset",this.render,this),this.listenTo(appState,"change:search_results_count",this.render),this.listenTo(appBits,"sync",this.render),this.render()},setp:function(e){e.preventDefault();var t=$(e.currentTarget).attr("data-id");return this.collection.switch(t),this},render:function(){return $(this.el).html(this.template({qcount:appBits.length,slugs:this.collection.toJSON()})),this},rerender:function(){return this},reset:function(){return this.render()}});
"use strict";var BitView=Backbone.View.extend({tagName:"li",template:CBB.templates.bitViewTpl,events:{},initialize:function(){},render:function(){return $(this.el).html("bitviewrender"),this}});
"use strict";var UpdatesView=Backbone.View.extend({el:$("#pane-update"),template:CBB.templates.updateViewTpl,events:{},initialize:function(){return this.collection.bind("sync",this.render,this),this.collection.fetch()},render:function(){for(var e=[],t=this.collection.models[0].get("report"),i={date:this.collection.models[0].get("date"),episodes:this.collection.models[0].get("episodes"),anno:this.collection.models[0].get("anno")};t.length>0;)e.push(t.splice(0,4));return $(this.el).html(this.template({meta:i,report:e})),this}});
"use strict";var BrowseView=Backbone.View.extend({template:CBB.templates.browseView,events:{"click .cbb-trigger":"trigger"},initialize:function(){return this.collection.bind("reset",this.render,this),this.proxyfetch()},trigger:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-type")+':"'+$(t.currentTarget).attr("data-target")+'"';return appQuery.set({raw:e}),this},proxyfetch:function(){return this.collection.fetch(),this},render:function(){return appActivity.set({message:"rendering aggregations for browse..."}),$(this.el).html(this.template({rows:this.collection.toJSON()})),appActivityView.stfu(),this}});
"use strict";var BitsView=Backbone.View.extend({el:"#search-bits",template:CBB.templates.bitsView,template_solo_bolo:CBB.templates.bitsViewSolo,events:{"click i.fa-map-marker":"zoomto","click .cbb-trigger":"trigger","click .cbb-facet-remove":function(t){t.preventDefault(),appQueryFacets.reset()},"click .cbb-bit-meta-bt":"meta"},initialize:function(){return this.collection.bind("sync",this.render,this),this.proxyfetch()},meta:function(t){t.preventDefault();var e=$(t.currentTarget).parents(".bit-data").find(".bit-data-meta");return $(t.currentTarget).toggleClass("active"),e.toggleClass("active"),this},trigger:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-type")+':"'+$(t.currentTarget).attr("data-target")+'"';return appQuery.set({raw:e}),this},zoomto:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-id").split(":");if("undefined"!=typeof BitGroup){var r=_.find(BitGroup.getLayers(),function(t){return t.options.location_id==e[1]&&t.options.location_type.indexOf(e[0])>=0});void 0!==r&&(r.openPopup(),map.fitBounds(r.getBounds()))}return this},proxyfetch:function(){return this.collection.fetch(),this},render:function(){if(this.collection.length<1){var t=null==appQuery.get("raw")||""==appQuery.get("raw")?"null query":appQuery.get("raw")+appQuery.query_facetadd();$(this.el).html("no bits for "+t+" (maybe <a href='#' class='cbb-facet-remove'>remove the facet</a>?)")}else 1==this.collection.length?$(this.el).html(this.template_solo_bolo({rows:this.collection.toJSON()})):$(this.el).html(this.template({rows:this.collection.toJSON()}));return appActivityView.stfu(),this}});
"use strict";function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var FacetsView=Backbone.View.extend({template:CBB.templates.facetsView,events:{"click .instance":"addfac"},initialize:function(t){return this.options=t,this.collection.bind("reset",this.render,this),this},addfac:function(t){t.preventDefault();var e=_defineProperty({},$(t.currentTarget).attr("data-type"),$(t.currentTarget).attr("data-id"));return appQueryFacets.facet(e),this},subset:function(){var t=$(this.el).attr("id").split("-")[2],e=this.collection.filter({type:t});return e},render:function(){return this.collection.length>0&&$(this.el).html(this.template({type:this.options.type,facets:this.collection.toJSON()})),this}});
"use strict";var CONFIG={verbose:!1,dev:!1,mode:"33",proxy:null,basemap:"pencil",index_root:"http://milleria.org:9200/cbb/_search?",default_query:"(episode:565)"};window.map=new L.Map("map",{zoomControl:!1,center:[51.505,-.09],zoom:7,attributionControl:!1}).on("moveend",function(e){"undefined"!=typeof appRoute&&appRoute.up()}),Handlebars.registerHelper("equal",function(e,a,s){if(arguments.length<3)throw new Error("Handlebars Helper equal needs 2 parameters");return e!=a?s.inverse(this):s.fn(this)}),Handlebars.registerHelper("debug",function(e){return console.log(e),new Handlebars.SafeString(this.instance)}),Handlebars.registerHelper("episodizer",function(e,a){if(e.toString().indexOf("/")>=0){var s=e.split("/"),n=s[s.length-1];return new Handlebars.SafeString(n)}return new Handlebars.SafeString(e.toString())});var states=[{name:"main",posish:"open",visible:!0},{name:"episodes",posish:"open",visible:!0},{name:"banner-bang",posish:"open",visible:!0}],baselayersdummified={layers:[{name:"dummy",active:!0,source:"localhost",nom:"A Real Dummy",thumb:"/images/bm-dummy-thumb.png",mapis:"dark",definition:{maxZoom:18,url:"/images/bm-dummy-thumb.png",noWrap:!0}},{name:"dummy",active:!1,source:"localhost",nom:"A Real Dummy",thumb:"/images/bm-dummy-thumb.png",mapis:"dark",definition:{maxZoom:18,url:"/images/bm-dummy-thumb.png",noWrap:!0}}]},baselayersdesk={layers:[{name:"super_mario",active:!1,source:"mapbox",nom:"Duncan Graham's Super Mario",thumb:"/images/bm-mapbox-mario.png",mapis:"light",definition:{subdomains:["a","b","c"],maxZoom:18,url:"https://{s}.tiles.mapbox.com/v4/duncangraham.552f58b0/{z}/{x}/{y}@2x.png?access_token=pk.eyJ1IjoiZHVuY2FuZ3JhaGFtIiwiYSI6IlJJcWdFczQifQ.9HUpTV1es8IjaGAf_s64VQ",noWrap:!0}},{name:"lichtenstein",active:!1,source:"mapbox",nom:"Katie Kowalsky's Pop Art (Inspored by Roy lichtenstein)",thumb:"/images/bm-mapbox-popart.png",mapis:"dark",definition:{subdomains:["a","b","c"],maxZoom:18,url:"https://{s}.tiles.mapbox.com/v4/katiekowalsky.236692c1/{z}/{x}/{y}@2x.png?access_token=pk.eyJ1Ijoia2F0aWVrb3dhbHNreSIsImEiOiJHR2hfdlBNIn0.GUMLsSnT-SYx4ew7b77kqw",noWrap:!0}},{name:"pencil",active:!0,source:"mapbox",nom:"Aj Ashton's Pencil Map",thumb:"/images/bm-mapbox-pencil.png",mapis:"dark",definition:{subdomains:["a","b","c"],maxZoom:18,url:"https://{s}.tiles.mapbox.com/v4/aj.03e9e12d/{z}/{x}/{y}@2x.png?access_token=pk.eyJ1IjoiYWoiLCJhIjoiY2lrZW1pczJzMDA1d3VybTJha216azVtdSJ9.vJBkGAq6CvN9vt0IwakQ-A",noWrap:!0}},{name:"opencycle_landscape",active:!1,source:"opencycle",nom:"OpenCycle Landscape",thumb:"/images/bm-opencycleland.png",mapis:"dark",definition:{maxZoom:18,subdomains:["a","b","c"],noWrap:!0,url:"http://{s}.tile3.opencyclemap.org/landscape/{z}/{x}/{y}.png"}}]},baselayersmobile={layers:[{name:"pencil",active:!0,source:"mapbox",nom:"Aj Ashton's Pencil Map",thumb:"/images/bm-mapbox-pencil.png",mapis:"dark",definition:{subdomains:["a","b","c"],maxZoom:18,url:"https://{s}.tiles.mapbox.com/v4/aj.03e9e12d/{z}/{x}/{y}@2x.png?access_token=pk.eyJ1IjoiYWoiLCJhIjoiY2lrZW1pczJzMDA1d3VybTJha216azVtdSJ9.vJBkGAq6CvN9vt0IwakQ-A",noWrap:!0}},{name:"dummy",active:!1,source:"localhost",nom:"A Real Dummy",thumb:"/images/bm-dummy-thumb.png",mapis:"dark",definition:{maxZoom:18,url:"/images/bm-dummy-thumb.png",noWrap:!0}}]},appSlugs=new Slugs([{name:"Home",slug:"home",active:"is-active"},{name:"Huh?",slug:"huh",active:!1},{name:"Search",slug:"search",active:!1},{name:"Browse",slug:"browse",active:!1},{name:"Update",slug:"update",active:!1},{name:"Help",slug:"help",active:!1}]),appQueryFacets=new QueryFacets,appQuery=new Query({raw:CONFIG.default_query}),appQueryView=new QueryView({model:appQuery}),appState=new State,appStateViewDownMenu=new StateViewDownMenu({model:appState}),appUpdates=new Updates,appUpdatesView=new UpdatesView({collection:appUpdates}),appFacetsBits=new Facets,appFacetsEpisodes=new Facets,appFacetsTags=new Facets,appFacetsGuests=new Facets,BitGroup=(new L.featureGroup).addTo(map),appLocations=new Locations,appBits=new Bits,appBitsView=new BitsView({collection:appBits}),appBrowseBits=new Browse,appBrowseTags=new Browse,appBrowseEpisodes=new Browse,appBrowseGuests=new Browse,appBrowseMaster=new Browse,appBrowseBitsView=new BrowseView({el:"#browse-bits",collection:appBrowseBits,type:"bit"}),appBrowseTagsView=new BrowseView({el:"#browse-tags",collection:appBrowseTags,type:"tag"}),appBrowseEpisodesView=new BrowseView({el:"#browse-episodes",collection:appBrowseEpisodes,type:"episode"}),appBrowseGuestsView=new BrowseView({el:"#browse-guests",collection:appBrowseGuests,type:"episode"}),appLocationsView=new LocationsView({collection:appLocations}),appSlugsViewPanes=new SlugsViewPanes({collection:appSlugs}),appSlugsViewPanesMenu=new SlugsViewPanesMenu({collection:appSlugs}),appFacetsBitsView=new FacetsView({el:"#search-facets-bits",collection:appFacetsBits,type:"bit"}),appFacetsEpisodesView=new FacetsView({el:"#search-facets-episodes",collection:appFacetsEpisodes,type:"episode"}),appFacetsTagsView=new FacetsView({el:"#search-facets-tags",collection:appFacetsTags,type:"tags"}),appFacetsGuestsView=new FacetsView({el:"#search-facets-guests",collection:appFacetsGuests,type:"guests"}),UTIL=new Util,appActivity=new Activity({message:"loading..."}),appActivityView=new ActivityView({model:appActivity}),baselayers="T"==CONFIG.mode?baselayersdummified:baselayersdesk,appBaseLayers=new BaseLayersCollection(baselayers.layers),appBaseLayersMenuView=new BaseLayersMenuView({collection:appBaseLayers}),appBaseMapView=new BaseLayersView({collection:appBaseLayers}),fields={fields:[{order:1,name:"anno",nom:"short annotation of the location -- e.g. 'one of Huell Howser's homes'",scope_and_use:"use it freely, e.g. <span class='copy-trigger' data-string='anno:huell'><span class='loc-string'>anno:huell</span><i class='glyphicon glyphicon-map-marker cbb-trigger-inline'></i></span> or <span class='copy-trigger' data-string='anno:cake+boss'><span class='loc-string'>anno:cake+boss</span><i class='glyphicon glyphicon-map-marker cbb-trigger-inline'></i></span>"},{order:5,name:"cartodb_id",nom:"unique id per site",scope_and_use:"use it to link to a specific instance, e.g. <span class='copy-trigger' data-string='cartodb_id:108'><span class='loc-string'>cartodb_id:108</span><i class='glyphicon glyphicon-map-marker cbb-trigger-inline'></i></span> - ~site of Bob Ducca's booth at the Silver Lake Farmers Market"},{order:3,name:"created_at",nom:"date the location was logged (has nothing to do with its appearance on the show)",scope_and_use:"I'm not sure anybody could possibly care. But I guess you could do Solr range queries with it."},{order:0,name:"name",nom:"name of the site (e.g. 'Six Flags Valencia' or 'Boston, MA'",scope_and_use:"this and anno are the primary fields and this is the one with the placename"},{order:2,name:"text",nom:"catch-all field",scope_and_use:"searching this field queries both anno and name fields (and eventually any other text we wanna throw in). If you don't type a specific field (e.g. you just type 'Dimello') this is the field that gets called."},{order:4,name:"updated_at",nom:"date of the last update to this record",scope_and_use:"Eh. You can <a href='#recent'>query for updates</a> with it I suppose."}]};$(document).ready(function(){}),$(document).keydown(function(e){17==e.keyCode&&appStateViewDownMenu.setm()});
"use strict";var Route=Backbone.Router.extend({routes:{"(:slug)(/:page)(/:query)(/:panestate)(/:activecouple)(/:basemap)(/:bbox)(/:facets)(/)":"default"},initialize:function(e){return e||(e={}),this.listenTo(appBaseLayers,"change:active",this.up),this.listenTo(appSlugs,"reset",this.up),this.listenTo(appQueryFacets,"add remove reset",this.up),this.listenTo(appQuery,"change:raw",this.up),this},ups:function(){return this},up:function(){return this.navigate(this.url(),{trigger:!0,replace:!1})},url:function(){var e=[],t=(_.map(map.getBounds().toBBoxString().split(","),function(e){return Math.round(e).toFixed(1)}),appSlugs.active().get("slug")),a=void 0===appQuery.get("page")?1:appQuery.get("page"),u=void 0===appQuery.get("raw")?"nil":appQuery.get("raw"),p=appBaseLayers.findWhere({active:!0}).get("name"),i=void 0===appState.get("downout")?"out":appState.get("downout"),n=void 0===appState.get("active")?"nil":appState.get("active"),s=_.map(map.getBounds().toBBoxString().split(","),function(e){return Number(Math.round(e+"e5")+"e-5")}),r=_.map(appQueryFacets.models,function(e){return encodeURI(JSON.stringify(e))}).join("::");e.push(t),e.push(a),e.push(u),e.push(p),e.push(i),e.push(n),e.push(s),e.push(r);var o="#"+e.join("/");return o},default:function(e,t,a,u,p,i,n,s){var r=void 0===e||null==e?appSlugs.active().get("slug"):e,o=void 0===t||null==t?1:t,l=void 0===a||null==a?CONFIG.default_query:a,d=void 0===p||null==p?"out":p,c=void 0===i||null==i?"nil":i;return void 0!==s&&null!==s&&_.each(s.split("::"),function(e){var t=$.parseJSON(decodeURI(e));void 0===appQueryFacets.findWhere(t)&&appQueryFacets.add(t)}),null!==n&&"undfined"!=typeof n&&map.fitBounds(UTIL.bounds_ob_from_bbox_string(n)),appBaseLayers.findWhere({active:!0}).get("name")!==u&&null!==u&&appBaseLayers.switch(u),appQuery.set({raw:l,page:o}),appSlugs.switch(r),appState.set({downout:d,active:c}),this}}),appRoute=new Route;Backbone.history.start();