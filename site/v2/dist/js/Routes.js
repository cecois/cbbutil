"use strict";var Route=Backbone.Router.extend({routes:{"(:slug)(/:page)(/:query)(/:panestate)(/:activecouple)(/:basemap)(/:bbox)(/:facets)(/)":"default"},initialize:function(e){return e||(e={}),this.listenTo(appBaseLayers,"change:active",this.up),this.listenTo(appSlugs,"reset",this.up),this.listenTo(appQueryFacets,"add remove",this.up),this.listenTo(appQuery,"change:raw",this.up),this},ups:function(){return this},up:function(){return this.navigate(this.url(),{trigger:!0,replace:!1})},url:function(){var e=[],t=(_.map(map.getBounds().toBBoxString().split(","),function(e){return Math.round(e).toFixed(1)}),appSlugs.active().get("slug")),a=void 0===appQuery.get("page")?1:appQuery.get("page"),u=void 0===appQuery.get("raw")?"nil":appQuery.get("raw"),p=appBaseLayers.findWhere({active:!0}).get("name"),i=void 0===appState.get("downout")?"out":appState.get("downout"),n=void 0===appState.get("active")?"nil":appState.get("active"),s=_.map(map.getBounds().toBBoxString().split(","),function(e){return Number(Math.round(e+"e5")+"e-5")}),r=_.map(appQueryFacets.models,function(e){return encodeURI(JSON.stringify(e))}).join("::");e.push(t),e.push(a),e.push(u),e.push(p),e.push(i),e.push(n),e.push(s),e.push(r);var o="#"+e.join("/");return o},default:function(e,t,a,u,p,i,n,s){var r=void 0===e||null==e?appSlugs.active().get("slug"):e,o=void 0===t||null==t?1:t,l=void 0===a||null==a?CONFIG.default_query:a,d=void 0===p||null==p?"out":p,c=void 0===i||null==i?"nil":i;return void 0!==s&&null!==s&&_.each(s.split("::"),function(e){var t=$.parseJSON(decodeURI(e));void 0===appQueryFacets.findWhere(t)&&appQueryFacets.add(t)}),null!==n&&"undfined"!=typeof n&&map.fitBounds(UTIL.bounds_ob_from_bbox_string(n)),appBaseLayers.findWhere({active:!0}).get("name")!==u&&null!==u&&appBaseLayers.switch(u),appQuery.set({raw:l,page:o}),appSlugs.switch(r),appState.set({downout:d,active:c}),this}}),appRoute=new Route;Backbone.history.start();